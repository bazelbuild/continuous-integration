---
platforms:
  ubuntu1604:
    shell_commands:
    - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
      android_ndk_repository/android_ndk_repository/' WORKSPACE
    - rm -f WORKSPACE.bak
    build_flags:
    - "--host_javabase=@bazel_toolchains//configs/ubuntu16_04_clang/1.2:jdk8"
    - "--javabase=@bazel_toolchains//configs/ubuntu16_04_clang/1.2:jdk8"
    - "--host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8"
    - "--java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8"
    - "--crosstool_top=@bazel_toolchains//configs/ubuntu16_04_clang/1.2/bazel_0.24.0/default:toolchain"
    - "--extra_toolchains=@bazel_toolchains//configs/ubuntu16_04_clang/1.2/bazel_0.24.0/cpp:cc-toolchain-clang-x86_64-default"
    - "--extra_execution_platforms=//:rbe_ubuntu1604_default"
    - "--extra_execution_platforms=//:rbe_ubuntu1604_highcpu"
    - "--host_platform=//:rbe_ubuntu1604_default"
    - "--platforms=//:rbe_ubuntu1604_default"
    - "--spawn_strategy=remote"
    - "--strategy=Javac=remote"
    - "--strategy=Closure=remote"
    - "--strategy=Genrule=remote"
    - "--define=EXECUTOR=remote"
    - "--remote_cache=remotebuildexecution.googleapis.com"
    - "--remote_executor=remotebuildexecution.googleapis.com"
    - "--tls_enabled=true"
    - "--action_env=PATH=/bin:/usr/bin:/usr/local/bin"
    - "--remote_timeout=1200"
    - "--jobs=100"
    - "--google_default_credentials"
    - "--remote_instance_name=projects/bazel-untrusted/instances/default_instance"
    build_targets:
    - "//src:bazel"
    - "//src:bazel_jdk_minimal"
    test_flags:
    - "--host_javabase=@bazel_toolchains//configs/ubuntu16_04_clang/1.2:jdk8"
    - "--javabase=@bazel_toolchains//configs/ubuntu16_04_clang/1.2:jdk8"
    - "--host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8"
    - "--java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8"
    - "--crosstool_top=@bazel_toolchains//configs/ubuntu16_04_clang/1.2/bazel_0.24.0/default:toolchain"
    - "--extra_toolchains=@bazel_toolchains//configs/ubuntu16_04_clang/1.2/bazel_0.24.0/cpp:cc-toolchain-clang-x86_64-default"
    - "--extra_execution_platforms=//:rbe_ubuntu1604_default"
    - "--extra_execution_platforms=//:rbe_ubuntu1604_highcpu"
    - "--host_platform=//:rbe_ubuntu1604_default"
    - "--platforms=//:rbe_ubuntu1604_default"
    - "--spawn_strategy=remote"
    - "--strategy=Javac=remote"
    - "--strategy=Closure=remote"
    - "--strategy=Genrule=remote"
    - "--define=EXECUTOR=remote"
    - "--remote_cache=remotebuildexecution.googleapis.com"
    - "--remote_executor=remotebuildexecution.googleapis.com"
    - "--tls_enabled=true"
    - "--action_env=PATH=/bin:/usr/bin:/usr/local/bin"
    - "--remote_timeout=1200"
    - "--jobs=100"
    - "--google_default_credentials"
    - "--remote_instance_name=projects/bazel-untrusted/instances/default_instance"
    - "--test_timeout=1200"
    test_targets:
    - "--"
    - "//src/test/..."
    - "//src/tools/execlog/..."
    - "//src/tools/singlejar/..."
    - "//src/tools/workspacelog/..."
    - "//third_party/ijar/..."
    - "//tools/aquery_differ/..."
    # See https://github.com/bazelbuild/bazel/issues/8033
    - "-//src/test/java/com/google/devtools/build/android/..."
    - "-//tools/android/..."
    - "-//src/test/shell/bazel/android/..."
    - "-//src/tools/singlejar:output_jar_simple_test"
    - "-//src/test/shell/bazel:bazel_coverage_java_test"
    - "-//src/test/shell/bazel:bazel_cc_code_coverage_test"
    - "-//src/test/shell/bazel:external_integration_test"
    - "-//src/test/shell/bazel:maven_test"
    - "-//src/test/shell/bazel:bazel_repository_cache_test"
    - "-//src/test/shell/bazel:bazel_sandboxing_cpp_test"
    - "-//src/shell/integration:java_integration_test"
    - "-//scripts/..."
